{% extends 'base.html' %}

{% block title %}Dashboard Administrador - Premium Car Detailing{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #06a7cf;
        --accent-color: #085173;
        --dark-color: #040404;
        --light-color: #cacaca;
        --gray-color: #848484;
    }

    .dashboard-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        color: var(--dark-color);
        padding: 2.5rem 0;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(6, 167, 207, 0.3);
        position: relative;
        overflow: hidden;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(4,4,4,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    .dashboard-header h1, .dashboard-header p {
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 4px rgba(4, 4, 4, 0.3);
    }

    .dashboard-card {
        margin-bottom: 2.5rem;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        height: 100%;
        background: rgba(202, 202, 202, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        overflow: hidden;
        position: relative;
    }

    .dashboard-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .dashboard-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 0.95);
    }

    .dashboard-card:hover::before {
        transform: scaleX(1);
    }

    /* Tarjetas temáticas específicas */
    .card-reservas {
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 107, 53, 0.05) 100%);
    }
    .card-reservas:hover {
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.15) 0%, rgba(255, 107, 53, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
    }

    .card-clientes {
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(78, 205, 196, 0.05) 100%);
    }
    .card-clientes:hover {
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.15) 0%, rgba(78, 205, 196, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(78, 205, 196, 0.3);
    }

    .card-bahias {
        background: linear-gradient(135deg, rgba(69, 183, 209, 0.1) 0%, rgba(69, 183, 209, 0.05) 100%);
    }
    .card-bahias:hover {
        background: linear-gradient(135deg, rgba(69, 183, 209, 0.15) 0%, rgba(69, 183, 209, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(69, 183, 209, 0.3);
    }

    .card-servicios {
        background: linear-gradient(135deg, rgba(150, 206, 180, 0.1) 0%, rgba(150, 206, 180, 0.05) 100%);
    }
    .card-servicios:hover {
        background: linear-gradient(135deg, rgba(150, 206, 180, 0.15) 0%, rgba(150, 206, 180, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(150, 206, 180, 0.3);
    }

    .card-pagos {
        background: linear-gradient(135deg, rgba(254, 202, 87, 0.1) 0%, rgba(254, 202, 87, 0.05) 100%);
    }
    .card-pagos:hover {
        background: linear-gradient(135deg, rgba(254, 202, 87, 0.15) 0%, rgba(254, 202, 87, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(254, 202, 87, 0.3);
    }

    .card-horarios {
        background: linear-gradient(135deg, rgba(255, 159, 243, 0.1) 0%, rgba(255, 159, 243, 0.05) 100%);
    }
    .card-horarios:hover {
        background: linear-gradient(135deg, rgba(255, 159, 243, 0.15) 0%, rgba(255, 159, 243, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(255, 159, 243, 0.3);
    }

    .card-empleados {
        background: linear-gradient(135deg, rgba(84, 160, 255, 0.1) 0%, rgba(84, 160, 255, 0.05) 100%);
    }
    .card-empleados:hover {
        background: linear-gradient(135deg, rgba(84, 160, 255, 0.15) 0%, rgba(84, 160, 255, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(84, 160, 255, 0.3);
    }

    .card-cargos {
        background: linear-gradient(135deg, rgba(95, 39, 205, 0.1) 0%, rgba(95, 39, 205, 0.05) 100%);
    }
    .card-cargos:hover {
        background: linear-gradient(135deg, rgba(95, 39, 205, 0.15) 0%, rgba(95, 39, 205, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(95, 39, 205, 0.3);
    }

    .dashboard-card .card-body {
        background: transparent;
        color: var(--dark-color);
        padding: 2rem;
        position: relative;
        z-index: 1;
    }

    /* Títulos y texto de las tarjetas */
    .dashboard-card h5 {
        font-weight: 700;
        font-size: 1.4rem;
        margin-bottom: 1rem;
        color: var(--dark-color);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .dashboard-card p {
        font-size: 1rem;
        color: var(--gray-color);
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    .dashboard-card .btn {
        border-radius: 25px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
    }

    .dashboard-card .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .dashboard-card .btn:hover::before {
        left: 100%;
    }

    /* Estilos para las tarjetas de estadísticas */
    .stats-value {
        font-size: 3rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(6, 167, 207, 0.3);
    }

    .stats-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray-color);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Estilos específicos para cada tarjeta de estadísticas */
    .stats-card-disponibles {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
        border-left: 4px solid #28a745;
    }

    .stats-card-disponibles .stats-icon {
        color: #28a745;
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
    }

    .stats-card-disponibles .stats-value {
        color: #28a745;
    }

    .stats-card-disponibles:hover {
        background: linear-gradient(135deg, rgba(40, 167, 69, 0.15) 0%, rgba(40, 167, 69, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(40, 167, 69, 0.3);
        transform: translateY(-10px) scale(1.02);
    }

    .stats-card-ocupadas {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
        border-left: 4px solid #ffc107;
    }

    .stats-card-ocupadas .stats-icon {
        color: #ffc107;
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
    }

    .stats-card-ocupadas .stats-value {
        color: #ffc107;
    }

    .stats-card-ocupadas:hover {
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(255, 193, 7, 0.3);
        transform: translateY(-10px) scale(1.02);
    }

    .stats-card-proceso {
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 107, 53, 0.05) 100%);
        border-left: 4px solid #ff6b35;
    }

    .stats-card-proceso .stats-icon {
        color: #ff6b35;
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
    }

    .stats-card-proceso .stats-value {
        color: #ff6b35;
    }

    .stats-card-proceso:hover {
        background: linear-gradient(135deg, rgba(255, 107, 53, 0.15) 0%, rgba(255, 107, 53, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
        transform: translateY(-10px) scale(1.02);
    }

    .stats-card-pendientes {
        background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(108, 117, 125, 0.05) 100%);
        border-left: 4px solid #6c757d;
    }

    .stats-card-pendientes .stats-icon {
        color: #6c757d;
        font-size: 3rem;
        margin-bottom: 1rem;
        text-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
    }

    .stats-card-pendientes .stats-value {
        color: #6c757d;
    }

    .stats-card-pendientes:hover {
        background: linear-gradient(135deg, rgba(108, 117, 125, 0.15) 0%, rgba(108, 117, 125, 0.08) 100%);
        box-shadow: 0 20px 40px rgba(108, 117, 125, 0.3);
        transform: translateY(-10px) scale(1.02);
    }
    .dashboard-card .card-title {
        color: var(--dark-color);
        font-weight: 700;
        font-size: 1.25rem;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .dashboard-card .card-text {
        color: var(--gray-color);
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 1.5rem;
    }

    /* Animaciones adicionales para iconos */
    .dashboard-icon::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease;
        z-index: -1;
    }

    .dashboard-card:hover .dashboard-icon::after {
        width: 120px;
        height: 120px;
    }

    /* Mejoras en botones */
    .dashboard-card .btn {
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .dashboard-card .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }

    .dashboard-card .btn:hover::before {
        left: 100%;
    }

    /* Iconos del dashboard con colores temáticos */
    .dashboard-icon {
        font-size: 3.5rem;
        margin-bottom: 1.5rem;
        text-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        position: relative;
    }
    .icon-reservas { color: #ff6b35; } /* Naranja vibrante para reservas */
    .icon-clientes { color: #4ecdc4; } /* Verde turquesa para clientes */
    .icon-bahias { color: #45b7d1; } /* Azul cielo para bahías */
    .icon-servicios { color: #96ceb4; } /* Verde menta para servicios */
    .icon-pagos { color: #feca57; } /* Amarillo dorado para pagos */
    .icon-horarios { color: #ff9ff3; } /* Rosa magenta para horarios */
    .icon-empleados { color: #54a0ff; } /* Azul brillante para empleados */
    .icon-cargos { color: #5f27cd; } /* Púrpura para cargos */

    /* Efectos hover para iconos */
    .dashboard-card:hover .dashboard-icon {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
    }

    .dashboard-card .card-title {
        color: var(--dark-color);
        font-weight: 700;
        font-size: 1.2rem;
        margin-bottom: 1rem;
    }

    .dashboard-card .card-text {
        color: rgba(4, 4, 4, 0.8);
        font-size: 0.95rem;
        line-height: 1.5;
        margin-bottom: 1.5rem;
    }

    .stats-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary-color);
        text-shadow: 0 2px 4px rgba(6, 167, 207, 0.3);
    }

    .stats-label {
        font-size: 0.85rem;
        color: var(--gray-color);
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    .bahia-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        margin-top: 30px;
        padding: 0 10px;
    }

    .bahia-card {
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        padding: 0;
        position: relative;
        overflow: hidden;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(15px);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 2px solid transparent;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
    }

    /* Diseño de bahía disponible - Estilo moderno con elementos visuales */
    .bahia-disponible {
        background: linear-gradient(145deg, 
            rgba(40, 167, 69, 0.05) 0%, 
            rgba(40, 167, 69, 0.02) 50%, 
            rgba(255, 255, 255, 0.95) 100%);
        border: 2px solid rgba(40, 167, 69, 0.2);
        position: relative;
    }

    .bahia-disponible::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #28a745, #20c997, #28a745);
        border-radius: 20px 20px 0 0;
    }

    .bahia-disponible::after {
        content: '🚗';
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        opacity: 0.1;
        transform: rotate(-15deg);
    }

    /* Diseño de bahía ocupada - Estilo de alerta visual */
    .bahia-ocupada {
        background: linear-gradient(145deg, 
            rgba(255, 193, 7, 0.08) 0%, 
            rgba(255, 193, 7, 0.03) 50%, 
            rgba(255, 255, 255, 0.95) 100%);
        border: 2px solid rgba(255, 193, 7, 0.3);
        position: relative;
    }

    .bahia-ocupada::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #ffc107, #ffeb3b, #ffc107);
        border-radius: 20px 20px 0 0;
        animation: pulse-warning 2s infinite;
    }

    .bahia-ocupada::after {
        content: '⚠️';
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.8rem;
        opacity: 0.15;
        animation: bounce 2s infinite;
    }

    /* Diseño de bahía en proceso - Estilo dinámico */
    .bahia-en-proceso {
        background: linear-gradient(145deg, 
            rgba(255, 107, 53, 0.08) 0%, 
            rgba(255, 107, 53, 0.03) 50%, 
            rgba(255, 255, 255, 0.95) 100%);
        border: 2px solid rgba(255, 107, 53, 0.3);
        position: relative;
    }

    .bahia-en-proceso::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #ff6b35, #ff8c42, #ff6b35);
        border-radius: 20px 20px 0 0;
        animation: progress-bar 3s infinite;
    }

    .bahia-en-proceso::after {
        content: '🔧';
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.8rem;
        opacity: 0.15;
        animation: rotate 4s linear infinite;
    }

    /* Efectos hover mejorados */
    .bahia-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }

    .bahia-disponible:hover {
        border-color: rgba(40, 167, 69, 0.4);
        box-shadow: 0 25px 50px rgba(40, 167, 69, 0.2);
    }

    .bahia-ocupada:hover {
        border-color: rgba(255, 193, 7, 0.5);
        box-shadow: 0 25px 50px rgba(255, 193, 7, 0.2);
    }

    .bahia-en-proceso:hover {
        border-color: rgba(255, 107, 53, 0.5);
        box-shadow: 0 25px 50px rgba(255, 107, 53, 0.2);
    }

    /* Título de la bahía rediseñado */
    .bahia-title {
        font-weight: 700;
        font-size: 1.4rem;
        margin: 50px 20px 15px 20px;
        color: #007bff;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .bahia-title i {
        font-size: 1.2rem;
        opacity: 0.8;
    }

    /* Información de la bahía con mejor estructura */
    .bahia-info {
        padding: 0 20px 20px 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .bahia-info p {
        margin: 0;
        font-size: 0.9rem;
        color: #495057;
        line-height: 1.4;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .bahia-info strong {
        color: #2c3e50;
        font-weight: 600;
        min-width: 70px;
    }

    /* Estado disponible mejorado */
    .bahia-disponible .bahia-info {
        padding: 20px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 15px;
    }

    .bahia-disponible .bahia-info::before {
        content: '✨';
        font-size: 3rem;
        opacity: 0.3;
        margin-bottom: 10px;
    }

    .bahia-disponible .bahia-info p {
        font-size: 1.1rem;
        color: #28a745;
        font-weight: 600;
        margin: 0;
        justify-content: center;
    }

    /* Estilos del cronómetro */
    .cronometro {
        background-color: rgba(0, 0, 0, 0.05);
        padding: 8px 12px;
        border-radius: 5px;
        font-weight: bold;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--primary-color);
    }
    .cronometro i {
        margin-right: 5px;
        color: var(--primary-color);
    }
    .tiempo-restante {
        color: var(--primary-color);
    }
    .tiempo-excedido {
        color: var(--accent-color);
        font-weight: bold;
    }

    /* Acciones de bahía mejoradas */
    .bahia-actions {
        padding: 15px 20px 20px 20px;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: auto;
    }

    .bahia-actions .btn {
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        padding: 8px 16px;
        border: none;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .bahia-actions .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    /* Animaciones */
    @keyframes pulse-warning {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }

    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0) rotate(-15deg); }
        40% { transform: translateY(-5px) rotate(-15deg); }
        60% { transform: translateY(-3px) rotate(-15deg); }
    }

    @keyframes progress-bar {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    @keyframes pulse-timer {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.02); }
    }

    /* Animaciones para alerta de tiempo excedido */
    @keyframes parpadeo-alerta {
        0%, 100% { 
            opacity: 1; 
            transform: scale(1);
        }
        50% { 
            opacity: 0.7; 
            transform: scale(1.02);
        }
    }

    @keyframes borde-alerta {
        0%, 100% { 
            border-color: #dc3545;
            box-shadow: 0 0 20px rgba(220, 53, 69, 0.4);
        }
        50% { 
            border-color: #ff1744;
            box-shadow: 0 0 30px rgba(220, 53, 69, 0.8);
        }
    }

    /* Clase para bahía con tiempo excedido - ALERTA VISUAL */
    .bahia-tiempo-excedido {
        animation: parpadeo-alerta 1.5s infinite ease-in-out;
        border: 3px solid #dc3545 !important;
        background: linear-gradient(145deg, 
            rgba(220, 53, 69, 0.15) 0%, 
            rgba(220, 53, 69, 0.08) 50%, 
            rgba(255, 255, 255, 0.95) 100%) !important;
    }

    .bahia-tiempo-excedido::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #dc3545, #ff1744, #dc3545);
        border-radius: 20px 20px 0 0;
        animation: borde-alerta 1s infinite;
    }

    .bahia-tiempo-excedido::after {
        content: '🚨';
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 1.8rem;
        opacity: 0.3;
        animation: parpadeo-alerta 1s infinite;
    }

    /* Efecto hover para bahía con tiempo excedido */
    .bahia-tiempo-excedido:hover {
        border-color: #dc3545 !important;
        box-shadow: 0 25px 50px rgba(220, 53, 69, 0.4) !important;
        animation-duration: 1s; /* Acelerar parpadeo en hover */
    }

    @keyframes tick {
        0%, 50% { transform: scale(1); }
        25% { transform: scale(1.1); }
    }

    /* Indicador de cámara mejorado */
    .camera-indicator {
        position: absolute;
        top: 15px;
        left: 20px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        z-index: 3;
    }

    .camera-indicator.active {
        background: rgba(40, 167, 69, 0.9);
        animation: pulse-camera 2s infinite;
    }

    @keyframes pulse-camera {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    .bahia-status {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 15px;
        height: 15px;
        border-radius: 50%;
    }
    .status-disponible {
        background-color: var(--primary-color);
    }
    .status-ocupada {
         background-color: var(--accent-color);
     }
     
     .status-en-proceso {
          background-color: var(--gray-color);
      }
    .bahia-info {
        margin-top: 15px;
        font-size: 0.95rem;
        flex-grow: 1;
        color: var(--dark-color);
    }
    .bahia-info p {
        margin-bottom: 5px;
    }
    .bahia-actions {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        margin-top: auto;
    }
    /* Estilos de cronómetro eliminados - ya no se necesitan */
    
    @keyframes parpadeo {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    .bahia-alerta {
        animation: parpadeo 1s infinite;
        box-shadow: 0 0 15px rgba(8, 81, 115, 0.7);
        border-left: 5px solid var(--accent-color);
    }

    /* Botones personalizados */
    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border: none;
        color: var(--dark-color);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(6, 167, 207, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.85rem;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(6, 167, 207, 0.4);
        color: var(--dark-color);
    }

    .btn-info {
        background: linear-gradient(135deg, var(--gray-color) 0%, var(--dark-color) 100%);
        border: none;
        color: var(--light-color);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(132, 132, 132, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.85rem;
    }

    .btn-info:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(132, 132, 132, 0.4);
        color: var(--light-color);
    }

    /* Título de sección mejorado */
    h2 {
        color: var(--dark-color);
        font-weight: 700;
        position: relative;
        padding-bottom: 0.5rem;
        margin-bottom: 2rem;
    }

    h2::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border-radius: 2px;
    }
</style>
{% endblock %}

{% block content %}
{% block dashboard_content %}
<header class="dashboard-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                {% if user_rol == 'admin_sistema' %}
                    <h1>Administrador del Sistema</h1>
                    <p class="lead">Configura todos los parámetros necesarios.</p>
                {% else %}
                    <h1>Administración del Autolavado</h1>
                    <p class="lead">Monitoreo de bahías y servicios en tiempo real</p>
                {% endif %}
            </div>
        </div>
    </div>
</header>

<div class="container">
    {% if user_rol != 'admin_sistema' %}
    <!-- Estadísticas rápidas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center dashboard-card stats-card-disponibles">
                <div class="card-body">
                    <div class="stats-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stats-value">{{ bahias_disponibles }}</div>
                    <div class="stats-label">BAHÍAS DISPONIBLES</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card stats-card-ocupadas">
                <div class="card-body">
                    <div class="stats-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stats-value">{{ bahias_ocupadas }}</div>
                    <div class="stats-label">BAHÍAS OCUPADAS</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card stats-card-proceso">
                <div class="card-body">
                    <div class="stats-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="stats-value">{{ bahias_en_proceso }}</div>
                    <div class="stats-label">SERVICIOS EN PROCESO</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card stats-card-pendientes">
                <div class="card-body">
                    <div class="stats-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stats-value">{{ reservas_pendientes }}</div>
                    <div class="stats-label">SERVICIOS PENDIENTES</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráfico de bahías -->
    <h2 class="mb-4 mt-5" style="color: #007bff; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-car" style="color: #17a2b8;"></i>
        <i class="fas fa-tint" style="color: #007bff;"></i>
        Estado de Bahías
    </h2>
    <div class="bahia-grid">
        {% for info in bahias_info %}
            <div class="bahia-card bahia-{{ info.estado }}">
                <!-- Indicador de cámara -->
                {% if info.bahia.tiene_camara %}
                    <div class="camera-indicator active">
                        <i class="fas fa-video"></i>
                        <span>CÁMARA</span>
                    </div>
                {% else %}
                    <div class="camera-indicator">
                        <i class="fas fa-video-slash"></i>
                        <span>SIN CÁMARA</span>
                    </div>
                {% endif %}

                <div class="bahia-status status-{{ info.estado }}"></div>
                <!-- Título de la bahía con iconos mejorados -->
                <div class="bahia-title">
                    <i class="fas fa-car-wash" style="color: #17a2b8;"></i>
                    <i class="fas fa-tint" style="color: #007bff;"></i>
                    {{ info.bahia.nombre }}
                </div>
                
                {% if info.estado != 'disponible' %}
                    <div class="bahia-info">
                        <p><i class="fas fa-user" style="color: #17a2b8;"></i> <strong>Cliente:</strong> {{ info.cliente.nombre }} {{ info.cliente.apellido }}</p>
                        <p><i class="fas fa-car" style="color: #6c757d;"></i> <strong>Vehículo:</strong> {{ info.vehiculo.marca }} {{ info.vehiculo.modelo }} ({{ info.vehiculo.placa }})</p>
                        <p><i class="fas fa-tools" style="color: #fd7e14;"></i> <strong>Servicio:</strong> {{ info.servicio.nombre }}</p>
                        <p><i class="fas fa-info-circle" style="color: #6f42c1;"></i> <strong>Estado:</strong> {{ info.reserva.get_estado_display }}</p>
                        
                        {% if info.estado == 'en_proceso' %}
                            <div class="cronometro" id="cronometro-{{ info.reserva.id }}" 
                                 data-inicio="{{ info.reserva.fecha_inicio_servicio|date:'c' }}" 
                                 data-duracion="{{ info.servicio.duracion_minutos }}">
                                <i class="fas fa-clock"></i>
                                <span class="tiempo-restante">Calculando...</span>
                            </div>
                        {% endif %}
                        
                        <div class="bahia-actions">
                            {% if info.bahia.tiene_camara %}
                                <a href="{% url 'reservas:ver_camara' info.reserva.stream_token %}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i> Ver Cámara
                                </a>
                            {% endif %}
                            
                            {% if info.estado == 'ocupada' %}
                                <form action="{% url 'reservas:iniciar_servicio' info.reserva.id %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-primary">
                                        <i class="fas fa-play"></i> Iniciar Servicio
                                    </button>
                                </form>
                            {% endif %}
                            
                            {% if info.estado == 'en_proceso' %}
                                <form action="{% url 'reservas:finalizar_servicio' info.reserva.id %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-success">
                                        <i class="fas fa-check"></i> Servicio Terminado
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <div class="bahia-info">
                        <p><i class="fas fa-check-circle" style="color: #28a745;"></i> Disponible para servicio</p>
                        <p><i class="fas fa-sparkles" style="color: #ffc107;"></i> Bahía lista y limpia</p>
                        {% if info.bahia.tiene_camara %}
                            <p><i class="fas fa-video"></i> Cámara disponible</p>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Configuración -->
    <h2 class="mb-4 mt-5" style="color: #28a745; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-cogs" style="color: #fd7e14;"></i>
        Configuración
    </h2>
    <div class="row mb-5 row-gap-4">
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-reservas">
                <div class="card-body">
                    <div class="dashboard-icon icon-reservas">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h5 class="card-title">Gestionar Reservas</h5>
                    <p class="card-text">Administra las reservas de servicios</p>
                    <a href="{% url 'reservas:reserva_list' %}" class="btn btn-primary">Ir a Reservas</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-clientes">
                <div class="card-body">
                    <div class="dashboard-icon icon-clientes">
                        <i class="fas fa-users"></i>
                    </div>
                    <h5 class="card-title">Gestionar Clientes</h5>
                    <p class="card-text">Administra los perfiles de clientes</p>
                    <a href="{% url 'reservas:cliente_list' %}" class="btn btn-primary">Ir a Clientes</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-bahias">
                <div class="card-body">
                    <div class="dashboard-icon icon-bahias">
                        <i class="fas fa-car"></i>
                    </div>
                    <h5 class="card-title">Gestionar Bahías</h5>
                    <p class="card-text">Administra las bahías de servicio</p>
                    <a href="{% url 'reservas:bahia_list' %}" class="btn btn-primary">Ir a Bahías</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-servicios">
                <div class="card-body">
                    <div class="dashboard-icon icon-servicios">
                        <i class="fas fa-concierge-bell"></i>
                    </div>
                    <h5 class="card-title">Gestionar Servicios</h5>
                    <p class="card-text">Administra los servicios ofrecidos</p>
                    <a href="{% url 'reservas:servicio_list' %}" class="btn btn-primary">Ir a Servicios</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-pagos">
                <div class="card-body">
                    <div class="dashboard-icon icon-pagos">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <h5 class="card-title">Medios de Pago</h5>
                    <p class="card-text">Configura los métodos de pago</p>
                    <a href="{% url 'reservas:medio_pago_list' %}" class="btn btn-primary">Ir a Medios de Pago</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-horarios">
                <div class="card-body">
                    <div class="dashboard-icon icon-horarios">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h5 class="card-title">Gestión de Horarios</h5>
                    <p class="card-text">Configura los horarios y fechas de atención</p>
                    <div class="d-grid gap-2">
                        <a href="{% url 'reservas:disponibilidad_horaria_list' %}" class="btn btn-primary">Horarios Semanales</a>
                        <a href="{% url 'reservas:horario_disponible_list' %}" class="btn btn-info">Horarios Disponibles</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-empleados">
                <div class="card-body">
                    <div class="dashboard-icon icon-empleados">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h5 class="card-title">Gestionar Empleados</h5>
                    <p class="card-text">Administra los perfiles de empleados y lavadores</p>
                    <a href="{% url 'empleados:empleado_list' %}" class="btn btn-primary">Ir a Empleados</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-center dashboard-card card-cargos">
                <div class="card-body">
                    <div class="dashboard-icon icon-cargos">
                        <i class="fas fa-id-badge"></i>
                    </div>
                    <h5 class="card-title">Gestionar Cargos</h5>
                    <p class="card-text">Administra los cargos de los empleados</p>
                    <a href="{% url 'empleados:cargo_list' %}" class="btn btn-primary">Ir a Cargos</a>
                </div>
            </div>
        </div>



    </div>
</div>
{% endblock dashboard_content %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Función para inicializar cronómetros
        function inicializarCronometros() {
            // Limpiar intervalos existentes para evitar múltiples cronómetros
            if (window.cronometroIntervalos) {
                window.cronometroIntervalos.forEach(intervalo => clearInterval(intervalo));
            }
            window.cronometroIntervalos = [];
            
            const cronometros = document.querySelectorAll('.cronometro');
            
            cronometros.forEach(cronometro => {
                const fechaInicio = cronometro.dataset.fechaInicio;
                const duracionMinutos = parseInt(cronometro.dataset.duracion);
                const tiempoDisplay = cronometro.querySelector('.tiempo-display');
                
                if (fechaInicio && duracionMinutos && tiempoDisplay) {
                    // Convertir fecha de inicio a timestamp
                    const inicioTimestamp = new Date(fechaInicio).getTime();
                    const duracionMs = duracionMinutos * 60 * 1000; // Convertir minutos a milisegundos
                    
                    // Función para actualizar el cronómetro
                    function actualizarCronometro() {
                        const ahora = new Date().getTime();
                        const tiempoTranscurrido = ahora - inicioTimestamp;
                        const tiempoRestante = duracionMs - tiempoTranscurrido;
                        
                        // Obtener la tarjeta de bahía para aplicar/quitar clases de alerta
                        const bahiaCard = cronometro.closest('.bahia-card');
                        
                        if (tiempoRestante > 0) {
                            // Tiempo restante - quitar clase de alerta si existe
                            if (bahiaCard && bahiaCard.classList.contains('bahia-tiempo-excedido')) {
                                bahiaCard.classList.remove('bahia-tiempo-excedido');
                            }
                            
                            const minutosRestantes = Math.floor(tiempoRestante / (1000 * 60));
                            const segundosRestantes = Math.floor((tiempoRestante % (1000 * 60)) / 1000);
                            
                            tiempoDisplay.innerHTML = `<span style="color: #28a745; font-weight: bold;">Tiempo Restante: ${minutosRestantes}:${segundosRestantes.toString().padStart(2, '0')}</span>`;
                        } else {
                            // Tiempo excedido - agregar clase de alerta para parpadeo y bordes rojos
                            if (bahiaCard && !bahiaCard.classList.contains('bahia-tiempo-excedido')) {
                                bahiaCard.classList.add('bahia-tiempo-excedido');
                                console.log('🚨 ALERTA: Bahía con tiempo excedido - aplicando animación de parpadeo');
                            }
                            
                            const tiempoExcedido = Math.abs(tiempoRestante);
                            const minutosExcedidos = Math.floor(tiempoExcedido / (1000 * 60));
                            const segundosExcedidos = Math.floor((tiempoExcedido % (1000 * 60)) / 1000);
                            
                            tiempoDisplay.innerHTML = `<span style="color: #dc3545; font-weight: bold;">Tiempo Excedido: +${minutosExcedidos}:${segundosExcedidos.toString().padStart(2, '0')}</span>`;
                        }
                    }
                    
                    // Actualizar inmediatamente
                    actualizarCronometro();
                    
                    // Actualizar cada segundo y guardar el intervalo
                    const intervalo = setInterval(actualizarCronometro, 1000);
                    window.cronometroIntervalos.push(intervalo);
                }
            });
        }
        
        // Inicializar cronómetros al cargar la página
        inicializarCronometros();
        
        // Verificar si existen los elementos del dashboard de bahías antes de configurar la actualización
        const bahiaGrid = document.querySelector('.bahia-grid');
        const statsValues = document.querySelectorAll('.stats-value');
        
        // Solo configurar la actualización AJAX si los elementos existen (para admin_autolavado)
        if (bahiaGrid && statsValues.length > 0) {
            // Función para actualizar los datos del dashboard mediante AJAX
            function actualizarDashboard() {
                fetch('{% url "reservas:obtener_bahias_info" %}', {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Actualizar el HTML de las bahías
                        bahiaGrid.innerHTML = data.html_bahias;
                        
                        // Actualizar los contadores
                        if (statsValues[0]) statsValues[0].textContent = data.bahias_disponibles;
                        if (statsValues[1]) statsValues[1].textContent = data.bahias_ocupadas;
                        if (statsValues[2]) statsValues[2].textContent = data.bahias_en_proceso;
                        if (statsValues[3]) statsValues[3].textContent = data.reservas_pendientes;
                        
                        // Reinicializar cronómetros después de actualizar el HTML
                        inicializarCronometros();
                        
                        console.log('Dashboard actualizado mediante AJAX');
                    })
                    .catch(error => {
                        console.error('Error al actualizar el dashboard:', error);
                    });
            }
            
            // Configurar actualización periódica del dashboard
            setInterval(actualizarDashboard, 15000); // Actualizar cada 15 segundos
            console.log('Actualización automática del dashboard configurada');
        } else {
            console.log('Dashboard de administrador del sistema - No se requiere actualización de bahías');
        }
        
        // Ya no necesitamos recargar la página completa, ya que usamos AJAX para actualizar los datos
        // La función actualizarDashboard() se encarga de mantener los datos actualizados
        console.log('Usando actualización AJAX en lugar de recarga completa de página');
    });
</script>
{% endblock %}

{% endblock content %}