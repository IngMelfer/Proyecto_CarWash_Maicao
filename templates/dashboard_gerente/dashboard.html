{% extends 'base.html' %}
{% load reservas_filters %}

{% block title %}Dashboard Gerente - CarWash Maicao{% endblock %}

{% block extra_css %}
<style>
  :root {
    --dg-primary: #056a96;
    --dg-secondary: #06a7cf;
    --dg-info: #36b9cc;
    --dg-success: #1cc88a;
    --dg-warning: #f6c23e;
    --dg-danger: #e74a3b;
    --dg-dark: #05334c;
  }
  /* Encabezado del dashboard */
  .dashboard-toolbar {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 14px;
    padding: 1rem 1.25rem;
    box-shadow: 0 8px 24px rgba(5, 106, 150, 0.1);
    border-left: 4px solid var(--dg-secondary);
  }
  .dashboard-toolbar h2 {
    font-weight: 700;
    color: var(--dg-dark);
    margin: 0;
  }
  .dashboard-toolbar .btn-group .btn {
    border-radius: 10px;
  }

  /* Tarjetas KPI */
  .stat-card {
    border: none;
    border-radius: 16px;
    background: linear-gradient(145deg, rgba(255,255,255,0.98), rgba(248,249,250,0.95));
    box-shadow: 0 12px 30px rgba(5,106,150,0.12);
    transition: transform .2s ease, box-shadow .2s ease;
    position: relative;
    overflow: hidden;
    min-height: 140px;
  }
  .stat-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 6px;
    background: linear-gradient(90deg, var(--dg-primary), var(--dg-secondary));
  }
  .stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 18px 40px rgba(5,106,150,0.18);
  }
  .stat-card .card-title {
    font-size: .95rem;
    letter-spacing: .5px;
    color: #6c757d;
    text-transform: uppercase;
    margin-bottom: .25rem;
  }
  .stat-card .card-text.h3 {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--dg-dark);
    margin-bottom: .25rem;
  }
  .stat-card small {
    color: #889084;
  }
  /* Variantes de color para la primera fila de KPI */
  .row.kpi-row .col-md-3:nth-child(1) .stat-card::after { background: linear-gradient(90deg, #4e73df, #6f84ff); }
  .row.kpi-row .col-md-3:nth-child(2) .stat-card::after { background: linear-gradient(90deg, var(--dg-info), #5ed0e2); }
  .row.kpi-row .col-md-3:nth-child(3) .stat-card::after { background: linear-gradient(90deg, var(--dg-warning), #ffdd57); }
  .row.kpi-row .col-md-3:nth-child(4) .stat-card::after { background: linear-gradient(90deg, var(--dg-success), #44d9a8); }

  /* Tarjetas de gráficos */
  .card .card-header {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-bottom: none;
    font-weight: 600;
    color: var(--dg-dark);
    padding: .6rem .9rem;
    font-size: .95rem;
    line-height: 1.2;
  }
  .card { border-radius: 16px; overflow: hidden; }

  /* Estado Operativo */
  #estadoProgressContainer .progress { background-color: #eef2f7; border-radius: 10px; overflow: hidden; }
  #estadoProgressContainer .progress-bar { transition: width .6s ease; }
  #estadoProgressContainer .col-md-6 { padding-right: 0.75rem; padding-left: 0.75rem; }

  /* Section titles */
  .section-title { font-weight: 700; color: var(--dg-dark); margin: .75rem 0 .5rem; display: flex; align-items: center; gap: .5rem; }
  .section-title .text-primary { color: var(--dg-primary) !important; }
  .section-title .text-info { color: var(--dg-info) !important; }
  .section-title .text-success { color: var(--dg-success) !important; }

  /* Layout ancho completo y centrado */
  .container-fluid { max-width: none; margin-left: 0; margin-right: 0; }

  /* Responsive */
  @media (max-width: 768px) {
    .stat-card { min-height: 120px; }
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="dashboard-toolbar d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Dashboard Gerente</h2>
    <div class="btn-group align-items-center">
      <a class="btn btn-outline-secondary" href="{% url 'dashboard_gerente:indicadores' %}">
        <i class="fas fa-chart-line me-1"></i> Indicadores
      </a>
      <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-file-export me-1"></i> Generar Informes
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="{% url 'dashboard_gerente:kpis' %}"><i class="fas fa-sliders-h me-1"></i> Configurar KPIs</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#" id="informe-pdf"><i class="fas fa-file-pdf me-1 text-danger"></i> Descargar PDF</a></li>
        <li><a class="dropdown-item" href="#" id="informe-excel"><i class="fas fa-file-excel me-1 text-success"></i> Descargar Excel</a></li>
      </ul>
    </div>
  </div>
  <!-- Segmentadores globales -->
  <form id="segmentadores-dashboard" class="row g-2 align-items-end mb-3" method="get">
    <div class="col-sm-8 d-flex flex-wrap gap-2">
      <input type="hidden" name="group_by" value="{{ applied_filters.group_by|default:'day' }}">
      <button class="btn btn-outline-primary" type="submit" name="segment" value="last7">Últimos 7 días</button>
      <button class="btn btn-outline-primary" type="submit" name="segment" value="last30">Últimos 30 días</button>
      <button class="btn btn-outline-primary" type="submit" name="segment" value="this_month">Este mes</button>
      <button class="btn btn-outline-primary" type="submit" name="segment" value="last_month">Mes anterior</button>
      <div class="d-flex align-items-end gap-2 ms-2">
        <div>
          <label class="form-label small mb-0">Desde</label>
          <input type="date" class="form-control" name="fi" value="{{ applied_filters.fi }}">
        </div>
        <div>
          <label class="form-label small mb-0">Hasta</label>
          <input type="date" class="form-control" name="ff" value="{{ applied_filters.ff }}">
        </div>
        <button class="btn btn-success" type="submit" name="segment" value="custom">
          <i class="fas fa-filter me-1"></i> Aplicar
        </button>
      </div>
    </div>

  </form>
  <!-- Sección: Ingresos -->
  <h4 class="section-title"><i class="fas fa-sack-dollar text-success"></i> Ingresos</h4>
  <div class="row kpi-row">
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Ingresos Totales</h5>
          <p class="card-text h3">${{ ingresos_total|format_price }}</p>
          <small class="text-muted">Acumulado histórico</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Ingresos ({{ segment_label }})</h5>
          <p class="card-text h3">${{ ingresos_segmento|format_price }}</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Descuentos ({{ segment_label }})</h5>
          <p class="card-text h3">-${{ descuentos_segmento|format_price }}</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Ticket Promedio ({{ segment_label }})</h5>
          <p class="card-text h3">${{ ticket_promedio_segmento|format_price }}</p>
    
        </div>
      </div>
    </div>
  </div>

  <!-- Sección: Servicios -->
  <h4 class="section-title"><i class="fas fa-concierge-bell text-info"></i> Servicios</h4>
  <div class="row mt-3">
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Reservas ({{ segment_label }})</h5>
          <p class="card-text h3">{{ reservas_segmento|format_price }}</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Cancelaciones ({{ segment_label }})</h5>
          <p class="card-text h3">{{ cancelaciones_segmento|format_price }}</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Completadas ({{ segment_label }})</h5>
          <p class="card-text h3">{{ completadas_segmento|format_price }}</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <div class="card-body">
          <h5 class="card-title">Tasa de Cancelación</h5>
          <p class="card-text h3">{{ tasa_cancelacion }}%</p>
          <small class="text-muted">Periodo: {{ segment_label }}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección: Clientes -->
  <h4 class="section-title"><i class="fas fa-users text-primary"></i> Clientes</h4>
  <!-- Resumen de Clientes (movido arriba) -->
  <div class="row mt-3">
    <div class="col-xl-6 col-lg-6 col-md-12">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h5 class="card-title">Clientes</h5>
          <p class="card-text h3">{{ total_clientes|format_price }}</p>
          <small class="text-success">+{{ nuevos_7 }} nuevos en 7 días</small>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6 col-md-12 mt-3 mt-xl-0">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h5 class="card-title">Clientes Activos ({{ segment_label }})</h5>
          <p class="card-text h3">{{ activos_30 }}</p>
          <small class="text-muted"><i class="fas fa-chart-line me-1"></i>Actividad en {{ segment_label }}</small>
        </div>
      </div>
    </div>
  </div>
  <div class="row mt-4">
    <div class="col-xl-8 col-lg-7 col-md-12">
      <div class="card h-100">
        <div class="card-header"><i class="fas fa-line-chart me-2"></i>Ingresos (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 320px;">
          <canvas id="ingresosChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-5 col-md-12 mt-3 mt-lg-0">
      <div class="card h-100">
        <div class="card-header"><i class="fas fa-chart-pie me-2"></i>Reservas por estado (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 320px;">
          <canvas id="estadoChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-xl-6 col-lg-6 col-md-12">
      <div class="card h-100">
        <div class="card-header"><i class="fas fa-list-ol me-2"></i>Servicios Top (Cantidad) — <span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span></div>
        <div class="card-body" style="height: 360px;">
          <canvas id="serviciosCantidadChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-xl-6 col-lg-6 col-md-12 mt-3 mt-lg-0">
      <div class="card h-100">
        <div class="card-header"><i class="fas fa-money-bill-trend-up me-2"></i>Servicios Top (Ingresos) — <span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span></div>
        <div class="card-body" style="height: 360px;">
          <canvas id="serviciosIngresosChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloque de tarjetas de clientes reubicado arriba; aquí removemos duplicados -->
  <!-- (Espacio intencionalmente limpio) -->

  <!-- Estado Operativo - Barras de Progreso -->
  <!-- Sección: Bahías -->
  <h4 class="section-title"><i class="fas fa-warehouse text-info"></i> Bahías</h4>

  <!-- Tarjetas rápidas de Bahías -->
  <div class="row mt-3">
    <div class="col-xl-4 col-lg-4 col-md-12">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h6 class="card-title"><i class="fas fa-parking text-success me-2"></i>Bahías Disponibles</h6>
          <p class="card-text h3">{{ bahias_disponibles|format_price }}</p>
          <small class="text-muted">Actualmente libres para agendar</small>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-4 col-md-12 mt-3 mt-xl-0">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h6 class="card-title"><i class="fas fa-video text-info me-2"></i>Bahías con Cámaras</h6>
          <p class="card-text h3">{{ bahias_con_camara|format_price }}</p>
          <small class="text-muted">Bahías activas con monitoreo</small>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-4 col-md-12 mt-3 mt-xl-0">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h6 class="card-title"><i class="fas fa-video-slash text-secondary me-2"></i>Bahías sin Cámaras</h6>
          <p class="card-text h3">{{ bahias_sin_camara|format_price }}</p>
          <small class="text-muted">Bahías activas sin monitoreo</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header"><i class="fas fa-tachometer-alt me-2"></i>Estado Operativo (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body">
          <div id="estadoProgressContainer" class="row g-3"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bahías: Gráficos -->
  <div class="row mt-4">
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header"><i class="fas fa-warehouse me-2"></i>Servicios por Bahía (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 320px;">
          <canvas id="bahiasServiciosChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header"><i class="fas fa-hourglass-half me-2"></i>Horas de uso por Bahía (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 320px;">
          <canvas id="bahiasUsoChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card">
        <div class="card-header"><i class="fas fa-dollar-sign me-2"></i>Ingresos por Bahía (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 320px;">
          <canvas id="bahiasIngresosChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección: Empleados -->
  <h4 class="section-title"><i class="fas fa-user-tie text-success"></i> Empleados</h4>
  <!-- Resumen de Empleados -->
  <div class="row mt-3">
    <div class="col-xl-4 col-lg-4 col-md-12">
      <div class="card stat-card h-100">
        <div class="card-body">
          <h5 class="card-title">Empleados Contratados</h5>
          <p class="card-text h3">{{ empleados_activos|format_price }}</p>
          <small class="text-muted">Calif. prom: {{ calificacion_promedio|floatformat:1 }}</small>
        </div>
      </div>
    </div>
  </div>
  <!-- Top Lavadores -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header"><i class="fas fa-user-tie me-2"></i>Top Lavadores por Servicios Completados (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 360px;">
          <canvas id="lavadoresChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Lavadores por Valoración -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-header"><i class="fas fa-star me-2"></i>Top Lavadores por Valoración (<span data-bs-toggle="tooltip" title="{{ segment_label_full }}">{{ segment_label_compact }}</span>)</div>
        <div class="card-body" style="height: 360px;">
          <canvas id="lavadoresValoracionChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <script>
   // Acciones de generación de informes (placeholder)
  document.addEventListener('DOMContentLoaded', function() {
    const btnPdf = document.getElementById('informe-pdf');
    const btnExcel = document.getElementById('informe-excel');
    if (btnPdf) btnPdf.addEventListener('click', function(e) {
      e.preventDefault();
      alert('Generación de informe PDF próximamente.');
    });
    if (btnExcel) btnExcel.addEventListener('click', function(e) {
      e.preventDefault();
      alert('Generación de informe Excel próximamente.');
    });
  });

  const estadoLabels = {{ estado_labels|safe }};
  const estadoData = {{ estado_data|safe }};
  const ingresosLabels = {{ ingresos_labels|safe }};
  const ingresosData = {{ ingresos_data|safe }};
  const serviciosLabels = {{ servicios_labels|safe }};
  const serviciosCantidad = {{ servicios_cantidad|safe }};
  const serviciosIngresos = {{ servicios_ingresos|safe }};
  const lavadoresLabels = {{ lavadores_labels|safe }};
  const lavadoresData = {{ lavadores_data|safe }};
  const lavadoresValLabels = {{ lavadores_val_labels|safe }};
  const lavadoresValData = {{ lavadores_val_data|safe }};
  // Bahías - variables
  const bahiasLabels = {{ bahias_labels|safe }};
  const bahiasServicios = {{ bahias_servicios|safe }};
  const bahiasUsoHoras = {{ bahias_uso_horas|safe }};
  const bahiasIngresos = {{ bahias_ingresos|safe }};

  // Utilidad de formateo
  function formatMiles(n, decimals = 0) {
    const num = typeof n === 'number' ? n : parseFloat(n);
    if (isNaN(num)) return n;
    try { return num.toLocaleString('es-CO', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }); } catch(e) { return (Math.round(num)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.'); }
  }
  const fmtPeso = (v) => '$' + formatMiles(v);

  // Ingresos últimos 30 días (paleta de ingresos)
  new Chart(document.getElementById('ingresosChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: ingresosLabels,
      datasets: [{
        label: 'Ingresos',
        data: ingresosData,
        borderColor: '#056a96',
        backgroundColor: 'rgba(5, 106, 150, 0.12)',
        tension: 0.3,
        fill: true
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label || 'Valor'}: ${fmtPeso(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Reservas por estado (paleta de servicios)
  new Chart(document.getElementById('estadoChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: estadoLabels,
      datasets: [{
        data: estadoData,
        backgroundColor: ['#1cc88a','#36b9cc','#4e73df','#f6c23e','#e74a3b']
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.label}: ${formatMiles(ctx.parsed)}` } } }
    }
  });

  // Estado Operativo - construir barras
  (function(){
    const container = document.getElementById('estadoProgressContainer');
    if (!container || !estadoLabels || !estadoData) return;
    const total = estadoData.reduce((a,b)=>a+(b||0),0) || 1;
    const palette = {
      'COMPLETADA': '#1cc88a',
      'EN_PROCESO': '#36b9cc',
      'CONFIRMADA': '#4e73df',
      'PENDIENTE': '#f6c23e',
      'CANCELADA': '#e74a3b'
    };
    estadoLabels.forEach((label, idx) => {
      const val = estadoData[idx] || 0;
      const pct = Math.round((val/total)*100);
      const col = palette[label] || '#858796';
      const wrapper = document.createElement('div');
      wrapper.className = 'col-md-6';
      wrapper.innerHTML = `
        <div class="d-flex align-items-center justify-content-between mb-1">
          <span class="text-muted small fw-semibold">${label}</span>
          <span class="small">${val} (${pct}%)</span>
        </div>
        <div class="progress" style="height: 10px;">
          <div class="progress-bar" role="progressbar" style="width: ${pct}%; background-color: ${col};" aria-valuenow="${pct}" aria-valuemin="0" aria-valuemax="100"></div>
        </div>`;
      container.appendChild(wrapper);
    });
  })();

  // Servicios Top cantidad (servicios)
  new Chart(document.getElementById('serviciosCantidadChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: serviciosLabels,
      datasets: [{
        label: 'Cantidad',
        data: serviciosCantidad,
        backgroundColor: '#36b9cc'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatMiles(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Servicios Top ingresos (ingresos)
  new Chart(document.getElementById('serviciosIngresosChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: serviciosLabels,
      datasets: [{
        label: 'Ingresos',
        data: serviciosIngresos,
        backgroundColor: '#056a96'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${fmtPeso(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Lavadores top (empleados)
  new Chart(document.getElementById('lavadoresChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: lavadoresLabels,
      datasets: [{
        label: 'Servicios Completados',
        data: lavadoresData,
        backgroundColor: '#1cc88a'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatMiles(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Lavadores por valoración promedio (★)
  new Chart(document.getElementById('lavadoresValoracionChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: lavadoresValLabels,
      datasets: [{
        label: 'Valoración Promedio (★)',
        data: lavadoresValData,
        backgroundColor: '#f6c23e'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          suggestedMin: 0,
          suggestedMax: 5
        }
      }
    }
  });

  // Bahías - Servicios
  new Chart(document.getElementById('bahiasServiciosChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: bahiasLabels,
      datasets: [{
        label: 'Servicios',
        data: bahiasServicios,
        backgroundColor: '#36b9cc'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatMiles(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Bahías - Horas de uso
  new Chart(document.getElementById('bahiasUsoChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: bahiasLabels,
      datasets: [{
        label: 'Horas de uso',
        data: bahiasUsoHoras,
        backgroundColor: '#4e73df'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${formatMiles(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });

  // Bahías - Ingresos
  new Chart(document.getElementById('bahiasIngresosChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: bahiasLabels,
      datasets: [{
        label: 'Ingresos',
        data: bahiasIngresos,
        backgroundColor: '#056a96'
      }]
    },
    options: { 
      responsive: true, maintainAspectRatio: false,
      plugins: { tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${fmtPeso(ctx.parsed.y)}` } } },
      scales: { y: { ticks: { callback: (v) => formatMiles(v) } } }
    }
  });
</script>
{% endblock %}